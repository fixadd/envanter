{% set prefix = fault_prefix or fault_entity %}
<div class="d-flex align-items-center" data-fault-entity="{{ fault_entity }}" data-fault-prefix="{{ prefix }}" data-fault-label="{{ fault_label or '' }}">
  <button type="button" class="btn btn-warning btn-sm d-flex align-items-center gap-2" data-fault-summary-trigger>
    <i class="bi bi-exclamation-triangle"></i>
    <span>Arızalı Durum</span>
    <span class="badge text-bg-dark" data-fault-count>0</span>
  </button>
</div>

<div class="modal fade" id="{{ prefix }}FaultSummaryModal" tabindex="-1" aria-hidden="true" data-fault-modal="summary" data-fault-prefix="{{ prefix }}">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ fault_label or 'Arızalı Kayıtlar' }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>
      <div class="modal-body">
        <div class="fault-summary-list" data-fault-list>
          <div class="text-muted small">Kayıt bulunamadı.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="{{ prefix }}FaultMarkModal" tabindex="-1" aria-hidden="true" data-fault-modal="mark" data-fault-prefix="{{ prefix }}">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <form class="modal-content fault-modal" data-fault-mark-form>
      <div class="modal-header">
        <h5 class="modal-title">Arızalı İşaretle</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="entity" value="{{ fault_entity }}">
        <input type="hidden" name="entity_id" data-fault-input="entity-id">
        <input type="hidden" name="entity_key" data-fault-input="entity-key">
        <input type="hidden" name="title" data-fault-input="title">
        <input type="hidden" name="meta" data-fault-input="meta">
        <div class="mb-3">
          <label class="form-label">Arızalı Cihaz No</label>
          <input type="text" class="form-control form-control-sm" name="device_no" data-fault-input="device" readonly>
        </div>
        <div class="mb-3">
          <label class="form-label">Arıza Nedeni</label>
          <textarea class="form-control form-control-sm" name="reason" rows="3" data-fault-input="reason" required></textarea>
        </div>
        <div class="mb-1">
          <label class="form-label">Gönderildiği Yer</label>
          <input type="text" class="form-control form-control-sm" name="destination" data-fault-input="destination">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">İptal</button>
        <button type="submit" class="btn btn-dark btn-sm">Kaydet</button>
      </div>
    </form>
  </div>
</div>

<div class="modal fade" id="{{ prefix }}FaultRepairModal" tabindex="-1" aria-hidden="true" data-fault-modal="repair" data-fault-prefix="{{ prefix }}">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <form class="modal-content" data-fault-repair-form>
      <div class="modal-header">
        <h5 class="modal-title">Tamir Edildi</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="entity" value="{{ fault_entity }}">
        <input type="hidden" name="entity_id" data-fault-repair="entity-id">
        <input type="hidden" name="entity_key" data-fault-repair="entity-key">
        <div class="small mb-2">
          <div><strong>Cihaz No:</strong> <span data-fault-info="device">-</span></div>
          <div><strong>Arıza Nedeni:</strong> <span data-fault-info="reason">-</span></div>
          <div><strong>Gönderildiği Yer:</strong> <span data-fault-info="destination">-</span></div>
        </div>
        <div class="mb-2">
          <label class="form-label">Not</label>
          <textarea class="form-control form-control-sm" name="note" rows="2" placeholder="Opsiyonel"></textarea>
        </div>
        <p class="small mb-0">Bu kayıt tamir edildi olarak işaretlenecek.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">İptal</button>
        <button type="submit" class="btn btn-primary btn-sm">Onayla</button>
      </div>
    </form>
  </div>
</div>

<style>
  .fault-modal {
    background-color: #c99700;
    color: #1f1f1f;
  }
  .fault-modal .modal-header,
  .fault-modal .modal-footer {
    border-color: rgba(0, 0, 0, 0.15);
  }
  .fault-modal .form-control,
  .fault-modal .form-control:focus {
    background-color: rgba(255, 255, 255, 0.85);
    color: #1f1f1f;
    border-color: rgba(0, 0, 0, 0.2);
  }
  .fault-summary-list {
    max-height: 240px;
    overflow-y: auto;
    display: grid;
    gap: .5rem;
  }
  .fault-summary-item {
    border: 1px solid #f1c21b;
    border-radius: .5rem;
    padding: .5rem .75rem;
    background: #fffbe6;
  }
  .fault-summary-item h6 {
    font-size: .9rem;
    margin-bottom: .25rem;
  }
  .fault-summary-item .small {
    font-size: .75rem;
  }
</style>
