{% extends "base.html" %} {% block title %}Yazƒ±cƒ± Takip{% endblock %} {% block
content %}
<div class="container-fluid p-3">
  <h5 class="mb-3">Yazƒ±cƒ±lar</h5>
  <div class="d-flex justify-content-between mb-3">
    <div class="d-flex gap-2">
      <button
        class="btn btn-success btn-sm"
        data-bs-toggle="modal"
        data-bs-target="#yaziciEkleModal"
      >
        Ekle
      </button>
      <button class="btn btn-secondary btn-sm">D√ºzenle</button>
      <button class="btn btn-danger btn-sm">Sil</button>
    </div>
    <div class="d-flex gap-2 align-items-center">
      <select class="form-select form-select-sm w-auto">
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
      <button class="btn btn-primary btn-sm">üîç</button>
      <input
        type="text"
        class="form-control form-control-sm"
        placeholder="Ara..."
      />
    </div>
  </div>
  <div class="table-responsive">
    <table class="table table-hover table-rounded">
      <thead>
        <tr>
          <th><input type="checkbox" onclick="stopRowClick(event)" /></th>
          <th>Envanter No</th>
          <th>Marka</th>
          <th>Model</th>
          <th>IP</th>
          <th>Durum</th>
          <th>ƒ∞≈ülemler</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr data-href="/printers/{{ r.id }}">
          <td>
            <input
              type="checkbox"
              name="select_row"
              value="{{ r.id }}"
              onclick="stopRowClick(event)"
            />
          </td>
          <td>{{ r.envanter_no }}</td>
          <td>{{ r.brand.name if r.brand else "" }}</td>
          <td>{{ r.model.name if r.model else "" }}</td>
          <td>{{ r.ip_adresi or '-' }}</td>
          <td>{{ r.kullanim_alani or '' }}</td>
          <td class="text-nowrap">
            <a
              class="btn btn-sm btn-outline-primary"
              href="/printers/{{ r.id }}/edit"
              onclick="stopRowClick(event)"
              >D√ºzenle</a
            >
            <button
              class="btn btn-sm btn-outline-warning"
              onclick="stopRowClick(event); openTonerModal('{{ r.id }}')"
            >
              Toner
            </button>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7" class="text-muted">Kayƒ±t yok</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="modal fade" id="yaziciEkleModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form method="post" action="/printers" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Yazƒ±cƒ± Ekle</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <div class="env-grid" id="yazici-ekle-grid">
            <div class="field">
              <label for="selYaziciMarka">Marka</label>
              <select
                id="selYaziciMarka"
                name="marka_id"
                class="ctrl"
                required
              ></select>
            </div>
            <div class="field">
              <label for="selYaziciModel">Model</label>
              <select
                id="selYaziciModel"
                name="model_id"
                class="ctrl"
                required
              ></select>
            </div>
            <div class="field">
              <label for="selYaziciKullanim">Kullanƒ±m Alanƒ±</label>
              <select
                id="selYaziciKullanim"
                name="kullanim_alani_id"
                class="ctrl"
                required
              ></select>
            </div>
            <div class="field">
              <label for="printerEnvanterNo">Envanter No</label>
              <input
                id="printerEnvanterNo"
                name="envanter_no"
                class="ctrl"
                required
                placeholder="ENV-000123"
              />
            </div>
            <div class="field">
              <label for="printerIp">IP Adresi</label>
              <input
                id="printerIp"
                name="ip_adresi"
                class="ctrl"
                placeholder="10.0.0.10"
              />
            </div>
            <div class="field">
              <label for="printerMac">MAC</label>
              <input
                id="printerMac"
                name="mac"
                class="ctrl"
                placeholder="AA:BB:CC:DD:EE:FF"
              />
            </div>
            <div class="field">
              <label for="printerHostname">Hostname</label>
              <input
                id="printerHostname"
                name="hostname"
                class="ctrl"
                placeholder="PRN-OFIS-01"
              />
            </div>
            <div class="field">
              <label for="printerIfs"
                >IFS No <span class="muted">(opsiyonel)</span></label
              >
              <input
                id="printerIfs"
                name="ifs_no"
                class="ctrl"
                placeholder="IFS-12345"
              />
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Kaydet</button>
        </div>
      </form>
    </div>
  </div>
</div>

<link
  href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"
  rel="stylesheet"
/>
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<script src="/static/js/choices_helpers.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const modalEl = document.getElementById("yaziciEkleModal");
    if (!modalEl) return;

    modalEl.addEventListener("shown.bs.modal", async () => {
      try {
        await choicesHelper.fillChoices({
          endpoint: "/api/lookup/marka",
          selectId: "selYaziciMarka",
          placeholder: "Marka se√ßiniz‚Ä¶",
        });
        await choicesHelper.fillChoices({
          endpoint: "/api/lookup/kullanim-alani",
          selectId: "selYaziciKullanim",
          placeholder: "Kullanƒ±m alanƒ± se√ßiniz‚Ä¶",
        });

        // Marka ‚Üí Model
        choicesHelper.bindBrandToModel("selYaziciMarka", "selYaziciModel");
      } catch (e) {
        console.error(e);
      }
    });
  });
</script>

<script>
  function openTonerModal(id) {
    // ‚Ä¶ modal a√ß; satƒ±r y√∂nlendirmesi tetiklenmez
  }
</script>
{% endblock %}
