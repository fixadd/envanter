{% extends "base.html" %} {% block title %}Lisans {{ 'Düzenle' if license else
'Ekle' }}{% endblock %} {% block content %}
<div class="container-fluid p-3 content">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h4 class="mb-0">Lisans {{ 'Düzenle' if license else 'Ekle' }}</h4>
    {% if not modal %}
    <a class="btn btn-light" href="{{ url_for('license_list') }}"
      >← Listeye Dön</a
    >
    {% endif %}
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <form
        method="post"
        action="{{ form_action }}{{ '?modal=1' if modal else '' }}"
        class="row g-3"
      >
        <div class="col-md-6">
          <label for="licenseAdi" class="form-label">Lisans Adı</label>
          <select id="licenseAdi" name="adi" class="form-select" required>
            <option value="">Seçiniz...</option>
            {% for ln in license_names %}
            <option
              value="{{ ln.name }}"
              {%
              if
              license
              and
              license.lisans_adi=""
              ="ln.name"
              %}selected{%
              endif
              %}
            >
              {{ ln.name }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-6">
          <label for="licenseKey" class="form-label">Lisans Anahtarı</label>
          <input
            id="licenseKey"
            name="anahtar"
            class="form-control"
            value="{{ license.anahtar if license else '' }}"
          />
        </div>

        <div class="col-md-6">
          <label for="licenseSorumlu" class="form-label"
            >Sorumlu Personel</label
          >
          <select
            id="licenseSorumlu"
            name="sorumlu_personel"
            class="form-select"
          >
            <option value="">(Seçiniz)</option>
            {% for u in users %}
            <option
              value="{{ u }}"
              {%
              if
              license
              and
              license.sorumlu_personel=""
              ="u"
              %}selected{%
              endif
              %}
            >
              {{ u }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-6">
          <label for="selBagliEnvanter" class="form-label"
            >Bağlı Olduğu Envanter No</label
          >
          <select id="selBagliEnvanter" name="inventory_id" class="form-select">
            <option value="">(Seçimsiz)</option>
            {% for inv in envanterler %}
            <option
              value="{{ inv.id }}"
              {%
              if
              license
              and
              license.inventory_id=""
              ="inv.id"
              %}selected{%
              endif
              %}
            >
              {{ inv.no }} — {{ inv.marka }} {{ inv.model }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-6">
          <label for="licenseIfs" class="form-label">IFS No</label>
          <input
            id="licenseIfs"
            name="ifs_no"
            class="form-control"
            value="{{ license.ifs_no if license else '' }}"
          />
        </div>

        <div class="col-md-6">
          <label for="licenseMail" class="form-label">Mail Adresi</label>
          <input
            id="licenseMail"
            type="email"
            name="mail_adresi"
            class="form-control"
            value="{{ license.mail_adresi if license else '' }}"
          />
        </div>

        <div class="col-12 d-flex gap-2 mt-3">
          <button class="btn btn-primary" type="submit">Kaydet</button>
          {% if not modal %}
          <a class="btn btn-secondary" href="{{ url_for('license_list') }}"
            >İptal</a
          >
          {% endif %}
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %} {{ super() }}
<script>
  // Aramalı select (Choices varsa)
  document.addEventListener("DOMContentLoaded", () => {
    if (window.Choices) {
      new Choices("#selBagliEnvanter", {
        searchEnabled: true,
        itemSelectText: "",
      });
    }
  });
</script>
{% endblock %}
