{% extends "base.html" %}
{% block title %}Envanter Ekle{% endblock %}
{% block content %}
<form method="post">
<section id="urun-ekle" class="container-fluid p-3">
  <h5 class="mb-3">Ürün / Envanter Ekle</h5>

  <div class="row g-4">
    <!-- Kullanım Alanı -->
    <div class="col-md-6">
      <label class="form-label d-block">Kullanım Alanı</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="kullanim_alani" aria-label="Kullanım Alanı">&#9776;</button>
        <span class="selected-text text-muted" data-for="kullanim_alani">Seçilmedi</span>
        <input type="hidden" name="kullanim_alani" id="kullanim_alani">
      </div>
    </div>

    <!-- Lisans Adı -->
    <div class="col-md-6">
      <label class="form-label d-block">Lisans Adı</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="lisans_adi" aria-label="Lisans Adı">&#9776;</button>
        <span class="selected-text text-muted" data-for="lisans_adi">Seçilmedi</span>
        <input type="hidden" name="lisans_adi" id="lisans_adi">
      </div>
    </div>

    <!-- Donanım Tipi -->
    <div class="col-md-6">
      <label class="form-label d-block">Donanım Tipi</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="donanim_tipi" aria-label="Donanım Tipi">&#9776;</button>
        <span class="selected-text text-muted" data-for="donanim_tipi">Seçilmedi</span>
        <input type="hidden" name="donanim_tipi" id="donanim_tipi">
      </div>
    </div>

    <!-- Marka -->
    <div class="col-md-6">
      <label class="form-label d-block">Marka</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="marka" aria-label="Marka">&#9776;</button>
        <span class="selected-text text-muted" data-for="marka">Seçilmedi</span>
        <input type="hidden" name="marka" id="marka">
      </div>
    </div>

    <!-- Fabrika -->
    <div class="col-md-6">
      <label class="form-label d-block">Fabrika</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="fabrika" aria-label="Fabrika">&#9776;</button>
        <span class="selected-text text-muted" data-for="fabrika">Seçilmedi</span>
        <input type="hidden" name="fabrika" id="fabrika">
      </div>
    </div>

    <!-- Model -->
    <div class="col-md-6">
      <label class="form-label d-block">Model</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="model" aria-label="Model">&#9776;</button>
        <span class="selected-text text-muted" data-for="model">Seçilmedi</span>
        <input type="hidden" name="model" id="model">
      </div>
    </div>
  </div>

  <div class="mt-3">
    <button class="btn btn-primary btn-sm">Kaydet</button>
    <a href="/inventory" class="btn btn-outline-secondary btn-sm">İptal</a>
  </div>
</section>
</form>

<style>
  #urun-ekle .lookup-btn{width:38px;height:38px;line-height:1;padding:0}
  #urun-ekle .selected-text{font-size:.9rem}
</style>

<script>window.SKIP_SELECT_ENHANCE = true;</script>

<script>
  (function(){
    // Bu fonksiyonu kendi modal/selector akışına bağla.
    // Örnek olarak basit prompt ile seçimi simüle ediyorum.
    function openPicker(entity, current){
      // TODO: Burayı kendi modalını çağıracak şekilde değiştir.
      const val = prompt(entity.toUpperCase() + " seçin:", current || "");
      // Kullanıcı iptal ettiyse null dön
      return (val && val.trim()) ? { id: val.trim(), text: val.trim() } : null;
    }

    document.querySelectorAll('#urun-ekle .lookup-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const entity = btn.dataset.entity;                 // örn: 'marka'
        const hidden = document.getElementById(entity);    // ilgili hidden
        const currentText = hidden.value || "";
        const picked = openPicker(entity, currentText);
        if(!picked) return;

        // Değeri gizliye yaz
        hidden.value = picked.id;

        // Yanındaki metni güncelle
        const labelSpan = document.querySelector(`#urun-ekle .selected-text[data-for="${entity}"]`);
        if(labelSpan){
          labelSpan.textContent = picked.text;
          labelSpan.classList.remove('text-muted');
        }
      });
    });
  })();
</script>
{% endblock %}
