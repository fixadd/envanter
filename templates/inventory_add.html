<form method="post" action="/inventory/create" class="needs-validation" novalidate>
  <div class="row g-3" id="envanter-ekle">

    <!-- Envanter No / Bilgisayar Adı -->
    <div class="col-md-6">
      <label class="form-label">Envanter No</label>
      <input name="envanter_no" type="text" class="form-control" required placeholder="ENV-000123">
    </div>
    <div class="col-md-6">
      <label class="form-label">Bilgisayar Adı</label>
      <input name="bilgisayar_adi" type="text" class="form-control" required placeholder="PC-OFIS-01">
    </div>

    <!-- Fabrika / Departman -->
    <div class="col-md-6">
      <label class="form-label">Fabrika</label>
      <div class="input-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="fabrika">&#9776;</button>
        <input id="fabrika_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
        <input type="hidden" id="fabrika" name="fabrika" required>
      </div>
    </div>
    <div class="col-md-6">
      <label class="form-label">Departman</label>
      <div class="input-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="departman">&#9776;</button>
        <input id="departman_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
        <input type="hidden" id="departman" name="departman" required>
      </div>
    </div>

    <!-- Donanım Tipi / Sorumlu Personel -->
    <div class="col-md-6">
      <label class="form-label">Donanım Tipi</label>
      <div class="input-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="donanim_tipi">&#9776;</button>
        <input id="donanim_tipi_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
        <input type="hidden" id="donanim_tipi" name="donanim_tipi" required>
      </div>
    </div>
    <div class="col-md-6">
      <label class="form-label">Sorumlu Personel</label>
      <div class="input-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="sorumlu_personel">&#9776;</button>
        <input id="sorumlu_personel_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
        <input type="hidden" id="sorumlu_personel" name="sorumlu_personel" required>
      </div>
    </div>

    <!-- Marka / Model -->
    <div class="col-md-6">
      <label class="form-label">Marka</label>
      <div class="input-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="marka">&#9776;</button>
        <input id="marka_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
        <input type="hidden" id="marka" name="marka" required>
      </div>
    </div>
    <div class="col-md-6">
      <label class="form-label">Model</label>
      <div class="input-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="model">&#9776;</button>
        <input id="model_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
        <input type="hidden" id="model" name="model" required>
      </div>
    </div>

    <!-- Seri No / IFS No -->
    <div class="col-md-6">
      <label class="form-label">Seri No</label>
      <input name="seri_no" type="text" class="form-control" required placeholder="SN123456789">
    </div>
    <div class="col-md-6">
      <label class="form-label">IFS No <span class="text-muted">(zorunlu değil)</span></label>
      <input name="ifs_no" type="text" class="form-control" placeholder="IFS-...">
    </div>

    <!-- Bağlı Makina No -->
    <div class="col-md-6">
      <label class="form-label">Bağlı Makina No <span class="text-muted">(zorunlu değil)</span></label>
      <input name="bagli_makina_no" type="text" class="form-control" placeholder="Makina No">
    </div>

    <!-- Not -->
    <div class="col-12">
      <label class="form-label">Not <span class="text-muted">(zorunlu değil)</span></label>
      <textarea name="notlar" class="form-control" rows="2" placeholder="Açıklama / notlar"></textarea>
    </div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <button type="submit" class="btn btn-primary">Kaydet</button>
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
  </div>
</form>

<style>
  #envanter-ekle .input-group > .lookup-btn { border-top-right-radius: 0; border-bottom-right-radius: 0; }
  #envanter-ekle .input-group > .lookup-display { border-top-left-radius: 0; border-bottom-left-radius: 0; }
  #envanter-ekle .lookup-display::placeholder { color: var(--bs-secondary-color); opacity: 1; }
</style>

<script>window.SKIP_SELECT_ENHANCE = true;</script>
<script>
(function(){
  // Burayı kendi seçim modalına bağla; şimdilik prompt ile seçim simüle
  function openPicker(entity, current){
    const v = prompt(entity.toUpperCase() + " seçin:", current || "");
    return (v && v.trim()) ? { id:v.trim(), text:v.trim() } : null;
  }
  function pickAndFill(entity){
    const hid = document.getElementById(entity);
    const dsp = document.getElementById(entity + '_display');
    const p = openPicker(entity, hid.value);
    if(!p) return;
    hid.value = p.id; dsp.value = p.text;
    dsp.classList.remove('is-invalid');
  }
  document.querySelectorAll('#envanter-ekle .lookup-btn').forEach(b=>{
    b.addEventListener('click', ()=>pickAndFill(b.dataset.entity));
  });
  document.querySelectorAll('#envanter-ekle .lookup-display').forEach(d=>{
    const entity = d.id.replace('_display','');
    d.addEventListener('click', ()=>pickAndFill(entity));
  });

  // submit’te required hidden’ları kontrol et
  const form = document.querySelector('#envanter-ekle').closest('form');
  form.addEventListener('submit', (e)=>{
    let ok = true;
    document.querySelectorAll('#envanter-ekle input[type="hidden"][required]').forEach(h=>{
      const d = document.getElementById(h.id + '_display');
      if(!h.value){ ok = false; d.classList.add('is-invalid'); }
    });
    if(!ok){ e.preventDefault(); e.stopPropagation(); }
  });
})();
</script>
