<form method="post" action="/inventory/create" class="needs-validation" novalidate>
  <div class="row g-3" id="envanter-ekle">

    <!-- Envanter No / Bilgisayar Adı -->
    <div class="col-md-6">
      <label class="form-label">Envanter No</label>
      <input name="envanter_no" type="text" class="form-control" required placeholder="ENV-000123">
    </div>
    <div class="col-md-6">
      <label class="form-label">Bilgisayar Adı</label>
      <input name="bilgisayar_adi" type="text" class="form-control" required placeholder="PC-OFIS-01">
    </div>

    <!-- Fabrika / Departman -->
    <div class="col-md-6">
      <label class="form-label">Fabrika</label>
      <input id="fabrika_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
      <input type="hidden" id="fabrika" name="fabrika" required>
    </div>
    <div class="col-md-6">
      <label class="form-label">Departman</label>
      <input id="departman_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
      <input type="hidden" id="departman" name="departman" required>
    </div>

    <!-- Donanım Tipi / Sorumlu Personel -->
    <div class="col-md-6">
      <label class="form-label">Donanım Tipi</label>
      <input id="donanim_tipi_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
      <input type="hidden" id="donanim_tipi" name="donanim_tipi" required>
    </div>
    <div class="col-md-6">
      <label class="form-label">Sorumlu Personel</label>
      <input id="sorumlu_personel_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
      <input type="hidden" id="sorumlu_personel" name="sorumlu_personel" required>
    </div>

    <!-- Marka / Model -->
    <div class="col-md-6">
      <label class="form-label">Marka</label>
      <input id="marka_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
      <input type="hidden" id="marka" name="marka" required>
    </div>
    <div class="col-md-6">
      <label class="form-label">Model</label>
      <input id="model_display" type="text" class="form-control lookup-display" placeholder="Seçiniz..." readonly>
      <input type="hidden" id="model" name="model" required>
    </div>

    <!-- Seri No / IFS No -->
    <div class="col-md-6">
      <label class="form-label">Seri No</label>
      <input name="seri_no" type="text" class="form-control" required placeholder="SN123456789">
    </div>
    <div class="col-md-6">
      <label class="form-label">IFS No <span class="text-muted">(zorunlu değil)</span></label>
      <input name="ifs_no" type="text" class="form-control" placeholder="IFS-...">
    </div>

    <!-- Bağlı Makina No -->
    <div class="col-md-6">
      <label class="form-label">Bağlı Makina No <span class="text-muted">(zorunlu değil)</span></label>
      <input name="bagli_makina_no" type="text" class="form-control" placeholder="Makina No">
    </div>

    <!-- Not -->
    <div class="col-12">
      <label class="form-label">Not <span class="text-muted">(zorunlu değil)</span></label>
      <textarea name="notlar" class="form-control" rows="2" placeholder="Açıklama / notlar"></textarea>
    </div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <button type="submit" class="btn btn-primary">Kaydet</button>
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
  </div>
</form>

<style>
  #envanter-ekle .lookup-display{ cursor:pointer; }
  #envanter-ekle .lookup-display.is-invalid{ border-color: var(--bs-danger); }
  #envanter-ekle .lookup-display::placeholder{ color: var(--bs-secondary-color); opacity: 1; }
</style>

<script>window.SKIP_SELECT_ENHANCE = true;</script>
<script>
(function(){
  // Burayı kendi seçim modalına bağla. Şimdilik prompt ile simüle:
  function openPicker(entity, current){
    const v = prompt(entity.toUpperCase() + " seçin:", current || "");
    return (v && v.trim()) ? { id:v.trim(), text:v.trim() } : null;
  }
  function bind(entity){
    const hid = document.getElementById(entity);
    const dsp = document.getElementById(entity + '_display');
    dsp.addEventListener('click', ()=>{
      const p = openPicker(entity, hid.value);
      if(!p) return;
      hid.value = p.id; dsp.value = p.text; dsp.classList.remove('is-invalid');
    });
  }
  ["fabrika","departman","donanim_tipi","sorumlu_personel","marka","model"].forEach(bind);

  // submit öncesi required hidden kontrolü
  document.querySelector('#envanter-ekle').closest('form').addEventListener('submit', (e)=>{
    let ok = true;
    ["fabrika","departman","donanim_tipi","sorumlu_personel","marka","model"].forEach(id=>{
      const hid = document.getElementById(id);
      const dsp = document.getElementById(id + "_display");
      if(!hid.value){ ok = false; dsp.classList.add('is-invalid'); }
    });
    if(!ok){ e.preventDefault(); e.stopPropagation(); }
  });
})();
</script>
