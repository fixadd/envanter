{% extends "base.html" %} {% block title %}Envanter Ekle{% endblock %} {% block
content %}
<form method="post">
  <div class="container-fluid p-3">
    <h5 class="mb-3">Ürün / Envanter Ekle</h5>

    <div id="urun-ekle" class="row g-4">
      {% include "partials/lookup_button.html" with label="Kullanım Alanı"
      name="kullanim_alani" entity="kullanim_alani" %} {% include
      "partials/lookup_button.html" with label="Lisans Adı" name="lisans_adi"
      entity="lisans_adi" %} {% include "partials/lookup_button.html" with
      label="Fabrika" name="fabrika" entity="fabrika" %} {% include
      "partials/lookup_button.html" with label="Donanım Tipi"
      name="donanim_tipi" entity="donanim_tipi" %} {% include
      "partials/lookup_button.html" with label="Marka" name="marka"
      entity="marka" %} {% include "partials/lookup_button.html" with
      label="Model" name="model" entity="model" %}
    </div>

    <div class="mt-3">
      <button class="btn btn-primary btn-sm">Kaydet</button>
      <a href="/inventory" class="btn btn-outline-secondary btn-sm">İptal</a>
    </div>
  </div>
</form>

<style>
  #urun-ekle .lookup-btn {
    width: 38px;
    height: 38px;
    line-height: 1;
    padding: 0;
  }
  #urun-ekle .selected-text {
    font-size: 0.9rem;
  }
</style>
<script>
  window.SKIP_SELECT_ENHANCE = true;
</script>
<script>
  // Butonlar için minimal kanca: kendi modalını burada çağır
  (function () {
    function openPicker(entity, current) {
      // TODO: kendi modal/Offcanvas
      const v = prompt(entity.toUpperCase() + " seçin:", current || "");
      return v && v.trim() ? { id: v.trim(), text: v.trim() } : null;
    }
    document.querySelectorAll("#urun-ekle .lookup-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        const entity = btn.dataset.entity;
        const hid =
          document.getElementById(entity) ||
          document.getElementById(btn.getAttribute("data-entity")) ||
          document.getElementById(entity);
        const hidden =
          document.getElementById(entity) ||
          document.getElementById(entity.replace(/[^a-z0-9_]/gi, ""));
        const input =
          document.getElementById(entity) ||
          document.querySelector(`input[name="${entity}"]`);
        const current = (input && input.value) || "";
        const pick = openPicker(entity, current);
        if (!pick) return;
        if (input) input.value = pick.id;
        const span =
          document.querySelector(
            `#urun-ekle .selected-text[data-for="${entity}"]`,
          ) ||
          document.querySelector(
            `#urun-ekle .selected-text[data-for="${input?.name}"]`,
          );
        if (span) {
          span.textContent = pick.text;
          span.classList.remove("text-muted");
        }
      });
    });
  })();
</script>
{% endblock %}
