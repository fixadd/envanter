<form method="post" action="/inventory/create" class="needs-validation" novalidate>
  <div class="row g-3" id="envanter-ekle">

    <!-- Envanter No -->
    <div class="col-md-6">
      <label class="form-label">Envanter No</label>
      <input name="envanter_no" type="text" class="form-control" required placeholder="ENV-000123">
    </div>

    <!-- Fabrika -->
    <div class="col-md-6">
      <label class="form-label">Fabrika</label>
      <div class="input-group lookup-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="fabrika">&#9776;</button>
        <input id="fabrika_display" type="text" class="form-control" value="Seçilmedi" readonly>
        <input type="hidden" id="fabrika" name="fabrika" required>
      </div>
    </div>

    <!-- Departman -->
    <div class="col-md-6">
      <label class="form-label">Departman</label>
      <div class="input-group lookup-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="departman">&#9776;</button>
        <input id="departman_display" type="text" class="form-control" value="Seçilmedi" readonly>
        <input type="hidden" id="departman" name="departman" required>
      </div>
    </div>

    <!-- Donanım Tipi -->
    <div class="col-md-6">
      <label class="form-label">Donanım Tipi</label>
      <div class="input-group lookup-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="donanim_tipi">&#9776;</button>
        <input id="donanim_tipi_display" type="text" class="form-control" value="Seçilmedi" readonly>
        <input type="hidden" id="donanim_tipi" name="donanim_tipi" required>
      </div>
    </div>

    <!-- Bilgisayar Adı -->
    <div class="col-md-6">
      <label class="form-label">Bilgisayar Adı</label>
      <input name="bilgisayar_adi" type="text" class="form-control" required placeholder="PC-OFIS-01">
    </div>

    <!-- Marka -->
    <div class="col-md-6">
      <label class="form-label">Marka</label>
      <div class="input-group lookup-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="marka">&#9776;</button>
        <input id="marka_display" type="text" class="form-control" value="Seçilmedi" readonly>
        <input type="hidden" id="marka" name="marka" required>
      </div>
    </div>

    <!-- Model -->
    <div class="col-md-6">
      <label class="form-label">Model</label>
      <div class="input-group lookup-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="model">&#9776;</button>
        <input id="model_display" type="text" class="form-control" value="Seçilmedi" readonly>
        <input type="hidden" id="model" name="model" required>
      </div>
    </div>

    <!-- Seri No -->
    <div class="col-md-6">
      <label class="form-label">Seri No</label>
      <input name="seri_no" type="text" class="form-control" required placeholder="SN123456789">
    </div>

    <!-- Sorumlu Personel -->
    <div class="col-md-6">
      <label class="form-label">Sorumlu Personel</label>
      <div class="input-group lookup-group">
        <button type="button" class="btn btn-outline-secondary lookup-btn" data-entity="sorumlu_personel">&#9776;</button>
        <input id="sorumlu_personel_display" type="text" class="form-control" value="Seçilmedi" readonly>
        <input type="hidden" id="sorumlu_personel" name="sorumlu_personel" required>
      </div>
    </div>

    <!-- Opsiyoneller -->
    <div class="col-md-6">
      <label class="form-label">Bağlı Makina No <small class="text-muted">(opsiyonel)</small></label>
      <input name="bagli_makina_no" type="text" class="form-control" placeholder="Makina No">
    </div>
    <div class="col-md-6">
      <label class="form-label">IFS No <small class="text-muted">(opsiyonel)</small></label>
      <input name="ifs_no" type="text" class="form-control" placeholder="IFS-...">
    </div>
    <div class="col-12">
      <label class="form-label">Not <small class="text-muted">(opsiyonel)</small></label>
      <textarea name="notlar" class="form-control" rows="2" placeholder="Açıklama / notlar"></textarea>
    </div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <button type="submit" class="btn btn-primary">Kaydet</button>
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
  </div>
</form>

<style>
  /* Yalnızca bu modalı düzenle */
  #envanter-ekle .lookup-group .form-control[readonly]{ background-color: var(--bs-body-bg); cursor: pointer; }
  #envanter-ekle .lookup-group .form-control[readonly].is-invalid{ border-color: var(--bs-danger); }
  /* Eski “zorunlu.” yazılarını tamamen gizle (varsa) */
  #envanter-ekle .invalid-feedback{ display: none !important; }
</style>

<script>window.SKIP_SELECT_ENHANCE = true;</script>
<script>
(function(){
  // Burayı kendi seçim modalına bağla; şimdilik prompt ile seçim simülasyonu
  function openPicker(entity, current){
    const v = prompt(entity.toUpperCase() + " seçin:", current || "");
    return (v && v.trim()) ? { id:v.trim(), text:v.trim() } : null;
  }

  function handlePick(entity){
    const hid = document.getElementById(entity);
    const disp = document.getElementById(entity + '_display');
    const pick = openPicker(entity, hid.value);
    if(!pick) return;
    hid.value = pick.id;
    disp.value = pick.text;
    disp.classList.remove('is-invalid');
  }

  // ≡ butonları ve readonly inputlar tıklanabilir
  document.querySelectorAll('#envanter-ekle .lookup-btn').forEach(b=>{
    b.addEventListener('click', ()=>handlePick(b.dataset.entity));
  });
  document.querySelectorAll('#envanter-ekle .lookup-group .form-control[readonly]').forEach(v=>{
    const entity = v.id.replace('_display','');
    v.addEventListener('click', ()=>handlePick(entity));
  });

  // Submit’te: required hidden’ları kontrol et; eksikse yanındaki display alanını kırmızı yap
  document.querySelector('#envanter-ekle').closest('form').addEventListener('submit', function(e){
    let ok = true;
    document.querySelectorAll('#envanter-ekle input[type="hidden"][required]').forEach(h=>{
      const disp = document.getElementById(h.id + '_display');
      if(!h.value){
        ok = false;
        if(disp){ disp.classList.add('is-invalid'); }
      }
    });
    if(!ok){ e.preventDefault(); e.stopPropagation(); }
  });
})();
</script>
