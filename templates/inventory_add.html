<form method="post" action="/inventory/create" class="needs-validation" novalidate>
  <div class="row g-3" id="envanter-ekle">

    <!-- Envanter No -->
    <div class="col-md-6">
      <label class="form-label">Envanter No</label>
      <input name="envanter_no" type="text" class="form-control" required placeholder="ENV-000123">
    </div>

    <!-- Fabrika -->
    <div class="col-md-6">
      <label class="form-label d-block">Fabrika</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="fabrika">&#9776;</button>
        <span class="selected-text text-muted" data-for="fabrika">Seçilmedi</span>
        <input type="hidden" name="fabrika" id="fabrika" required>
      </div>
    </div>

    <!-- Departman -->
    <div class="col-md-6">
      <label class="form-label d-block">Departman</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="departman">&#9776;</button>
        <span class="selected-text text-muted" data-for="departman">Seçilmedi</span>
        <input type="hidden" name="departman" id="departman" required>
      </div>
    </div>

    <!-- Donanım Tipi -->
    <div class="col-md-6">
      <label class="form-label d-block">Donanım Tipi</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="donanim_tipi">&#9776;</button>
        <span class="selected-text text-muted" data-for="donanim_tipi">Seçilmedi</span>
        <input type="hidden" name="donanim_tipi" id="donanim_tipi" required>
      </div>
    </div>

    <!-- Bilgisayar Adı -->
    <div class="col-md-6">
      <label class="form-label">Bilgisayar Adı</label>
      <input name="bilgisayar_adi" type="text" class="form-control" required placeholder="PC-OFIS-01">
    </div>

    <!-- Marka -->
    <div class="col-md-6">
      <label class="form-label d-block">Marka</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="marka">&#9776;</button>
        <span class="selected-text text-muted" data-for="marka">Seçilmedi</span>
        <input type="hidden" name="marka" id="marka" required>
      </div>
    </div>

    <!-- Model -->
    <div class="col-md-6">
      <label class="form-label d-block">Model</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="model">&#9776;</button>
        <span class="selected-text text-muted" data-for="model">Seçilmedi</span>
        <input type="hidden" name="model" id="model" required>
      </div>
    </div>

    <!-- Seri No -->
    <div class="col-md-6">
      <label class="form-label">Seri No</label>
      <input name="seri_no" type="text" class="form-control" required placeholder="SN123456789">
    </div>

    <!-- Sorumlu Personel -->
    <div class="col-md-6">
      <label class="form-label d-block">Sorumlu Personel</label>
      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm lookup-btn" data-entity="sorumlu_personel">&#9776;</button>
        <span class="selected-text text-muted" data-for="sorumlu_personel">Seçilmedi</span>
        <input type="hidden" name="sorumlu_personel" id="sorumlu_personel" required>
      </div>
    </div>

    <!-- Opsiyoneller -->
    <div class="col-md-6">
      <label class="form-label">Bağlı Makina No <small class="text-muted">(opsiyonel)</small></label>
      <input name="bagli_envanter_no" type="text" class="form-control" placeholder="Makina No">
    </div>

    <div class="col-md-6">
      <label class="form-label">IFS No <small class="text-muted">(opsiyonel)</small></label>
      <input name="ifs_no" type="text" class="form-control" placeholder="IFS-...">
    </div>

    <div class="col-12">
      <label class="form-label">Not <small class="text-muted">(opsiyonel)</small></label>
      <textarea name="notlar" class="form-control" rows="2" placeholder="Açıklama / notlar"></textarea>
    </div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <button type="submit" class="btn btn-primary">Kaydet</button>
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
  </div>
</form>

<style>
  #envanter-ekle .lookup-btn{width:38px;height:38px;line-height:1;padding:0}
  #envanter-ekle .selected-text{font-size:.9rem}
</style>
<script>window.SKIP_SELECT_ENHANCE = true;</script>
<script>
(function(){
  // TODO: Burayı kendi seçim modalına bağla; şimdilik prompt ile seçim simüle.
  function openPicker(entity, current){ const v = prompt(entity.toUpperCase()+' seçin:', current||''); return (v&&v.trim())?{id:v.trim(),text:v.trim()}:null; }
  document.querySelectorAll('#envanter-ekle .lookup-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const entity = btn.dataset.entity;
      const hidden = document.getElementById(entity);
      const picked = openPicker(entity, hidden?.value);
      if(!picked) return;
      hidden.value = picked.id;
      const span = document.querySelector(`#envanter-ekle .selected-text[data-for="${entity}"]`);
      if(span){ span.textContent = picked.text; span.classList.remove('text-muted'); }
    });
  });
})();
</script>
