{% extends "base.html" %} {% block title %}Hurdalar{% endblock %} {% block
content %}
<div class="container-fluid py-4">
  <div class="page-shell">
    <header class="page-header">
      <div class="page-header__heading">
        <span class="eyebrow text-primary">Yazıcı Takip</span>
        <h1 class="page-header__title">Hurdaya Ayrılan Yazıcılar</h1>
        <p class="page-header__subtitle">
          Hurdaya ayrılan yazıcı kayıtlarını inceleyin ve detaylara erişin.
        </p>
      </div>
    </header>

    <div class="page-card soft-card">
      <div class="table-responsive">
        <table class="table table-sm align-middle table-rounded">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Marka/Model</th>
              <th>Seri</th>
              <th>Fabrika</th>
              <th>Kullanım Alanı</th>
              <th>Sorumlu</th>
              <th>Bağlı Env.</th>
              <th>Not</th>
              <th>Tarih</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% if mode == "table" %} {% for r in rows %}
            <tr>
              <td>#{{ r.printer_id }}</td>
              <td>{{ r.snapshot.marka }} {{ r.snapshot.model }}</td>
              <td>{{ r.snapshot.seri_no }}</td>
              <td>{{ r.snapshot.fabrika or '-' }}</td>
              <td>{{ r.snapshot.kullanim_alani or '-' }}</td>
              <td>{{ r.snapshot.sorumlu_personel or '-' }}</td>
              <td>{{ r.snapshot.bagli_envanter_no or '-' }}</td>
              <td>{{ r.reason or '-' }}</td>
              <td>{{ r.created_at.strftime("%d.%m.%Y %H:%M") }}</td>
              <td>
                <button
                  class="btn btn-outline-secondary btn-sm view-btn"
                  data-id="{{ r.printer_id }}"
                  title="Detayı Göster"
                >
                  <i class="bi bi-eye"></i>
                </button>
              </td>
            </tr>
            {% endfor %} {% else %} {% for p in rows %}
            <tr>
              <td>#{{ p.id }}</td>
              <td>{{ p.marka }} {{ p.model }}</td>
              <td>{{ p.seri_no }}</td>
              <td>{{ p.fabrika or '-' }}</td>
              <td>{{ p.kullanim_alani or '-' }}</td>
              <td>{{ p.sorumlu_personel or '-' }}</td>
              <td>{{ p.bagli_envanter_no or '-' }}</td>
              <td>-</td>
              <td>-</td>
              <td>
                <button
                  class="btn btn-outline-secondary btn-sm view-btn"
                  data-id="{{ p.id }}"
                  title="Detayı Göster"
                >
                  <i class="bi bi-eye"></i>
                </button>
              </td>
            </tr>
            {% endfor %} {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="hurdaDetayModal" tabindex="-1">
  <div
    class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable"
  >
    <div class="modal-content border-0 bg-transparent p-0">
      <div class="modal-shell">
        <div class="modal-shell__header">
          <div class="modal-shell__heading">
            <h5 class="modal-shell__title">Hurda Detayı</h5>
            <p class="modal-shell__subtitle">
              Hurdaya ayrılan yazıcıya ilişkin ayrıntılı bilgileri görüntüleyin.
            </p>
          </div>
          <div class="modal-shell__header-actions">
            <button
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Kapat"
            ></button>
          </div>
        </div>
        <div class="modal-shell__body" id="hurdaDetayBody">Yükleniyor...</div>
      </div>
    </div>
  </div>
</div>

<script>
  document.querySelectorAll(".view-btn").forEach((b) => {
    b.addEventListener("click", async () => {
      const id = b.dataset.id;
      const r = await fetch("/scrap/printer/" + id);
      const h = await r.text();
      document.getElementById("hurdaDetayBody").innerHTML = h;
      new bootstrap.Modal(document.getElementById("hurdaDetayModal")).show();
    });
  });
</script>

{% endblock %}
